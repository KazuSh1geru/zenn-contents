---
title: "Difyセルフホスト環境構築プロジェクト振り返り"
emoji: "💬"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Dify","プロジェクト振り返り","QCD+S"]
published: false
---

## はじめに
本記事では、エンタープライズ向けAIプラットフォーム「Dify」のセルフホスト環境を構築したプロジェクトをプロジェクトマネージャ視点で振り返り、得られた成果と学びを共有します。特に「Q（Quality）」「C（Cost）」「D（Delivery）」にScope（範囲）を加えた「QCD+S」の各観点を整理し、PM・ステークホルダー間の合意形成やタスク管理のベストプラクティスを紹介します。

## プロジェクト概要
- **背景**: セキュリティ要件によりクラウド版利用が制限され、社内セルフホスト構築を決定
- **期間**: 2025年1月～2月
- **チーム構成**: PM兼エンジニア(私)、上司、SRE1名、セカンドオピニオン1名
- **初期スコープ（フェーズ1）**: 既存Dify AIツールをセルフホスト環境で稼働させるインフラ構築一式

## フェーズ1: 既存AIツール展開のセルフホスト構築
### 要件定義とスコープ設定
1. **要求整理**: セキュリティ（HTTPS/Google認証）、可用性・性能（p95/p50、同時300ユーザー）、監査ログ取得など
2. **スコープ区分**: GitHub Project上で3フェーズに分割し、各フェーズに完了基準を定義
3. **タスク粒度管理**: LはSub-issueへ分解、Mはフィボナッチ数でポイント付与、Sは即着手可能なレベルに設定

### QCD+Sによる振り返り
#### Quality
- 通信暗号化（HTTPS）とGoogle認証によるアクセス制御を実装
- Fargate標準キャパ提供に変更し、ECSタスク停止エラーを解消
- 300ユーザー同時アクセス負荷テストで成功率99%、p95=10秒、中央値=5秒を達成
- ECSヘルスチェック失敗・5xx検知時にSlackへ自動通知

#### Cost
- AWS利用料: dev/prod各環境月額¥200,000相当（年間約¥2,400,000）→エンタープライズ版比較で¥8,000,000以上を節約
- 人件費: SRE支援1人日、チーム相談総計約9時間
- 課題: 初期にコスト目標を合意せず、定量的な達成可否評価が困難に

#### Delivery
- 予定リリース: 1/31 → 実績リリース: 2/7（1週間遅延）
- 大きな障害なし。トレーニングスケジュール調整は運用でカバー

#### Scope
- **完了範囲**: ECS/Fargate、ALB+NGINX、RDSスナップショット、CloudWatch監視
- **次フェーズ**: 同時800ユーザー対応、関連サービスステータス監視、スナップショット復旧検証

## 認識齟齬と改善施策
### リリース計画のズレ
- **課題**: 「Best Effort」という曖昧な見積もりが上司に懸念される
- **対策**: タスク分解と所要時間をGitHub Projectに明記し、フィボナッチ数ポイントで見積もり精度を向上

### 性能要件の認識差
- **課題**: セキュリティ・可用性のみを重視し、性能（p95レイテンシ等）を見落とす
- **対策**: 性能指標（p95=10秒、p50=5秒、成功率99%）をドキュメント化し、ベンチマーク結果を共有

### 合意形成プロセスの強化
- 要件定義書・レビューシートを作成し、テックリード・上司レビューを定期的に実施
- 議事録をSlack/Confluenceへ記録し、承認フローを可視化
- 主要ステークホルダーを各フェーズ前に段階的に巻き込み、見える化した承認を取得

## ベストプラクティス
1. **タスク粒度の徹底管理**: S/M/Lのサイズ区分とポイント見積もりで工数見積もりと進捗確認を効率化
2. **QCD+Sの定量化**: 定量指標を文書化し、合意形成と認識齟齬の早期発見を実現
3. **レビューとドキュメントの自動化**: 要件定義書・議事録をテンプレート化し、承認プロセスの透明性を担保

## おわりに
本プロジェクトでは、PMとしてタスク管理と合意形成を徹底しつつ、技術チームと緊密に連携することで、高品質・低コスト・予定内納品を達成しました。次フェーズでは大規模化への対応と復旧手順の自動化を進め、さらに堅牢なセルフホスト環境を構築していきます。
